addpath('/home/yjlee/projects/weakVideo/misc');

num_frames = numel(tracks);

check_tube_length = 3; % 1 before and 1 after (make this odd)
before_after_length = floor(check_tube_length/2);
for ii=floor(check_tube_length/2)+1:num_frames-floor(check_tube_length/2)    
    boxes = tracks(ii).bbox_info;
    
    % 1st frames
    check = zeros(size(boxes,1),check_tube_length-1);
    count = 1;
    for jj=-1*before_after_length:1:before_after_length
        if jj==0
            continue;
        end
        this_boxes = tracks(ii+jj).bbox_info;
        for kk=1:size(boxes,1)
            this_label = boxes(kk,5);
            match = find(this_boxes(:,5)==this_label);
            
            if isempty(match)
                check(kk,count) = 0;
            else
                overlaps = computeOverlap(boxes(kk,:), this_boxes(match,:));
                if max(overlaps)>0.5
                    check(kk,count) = 1;
                end
            end
        end
        count = count + 1;
    end
    
    % last frames
    
    % middle frames
    check = zeros(size(boxes,1),check_tube_length-1);
    count = 1;
    for jj=-1*before_after_length:1:before_after_length
        if jj==0
            continue;
        end
        this_boxes = tracks(ii+jj).bbox_info;
        for kk=1:size(boxes,1)
            this_label = boxes(kk,5);
            match = find(this_boxes(:,5)==this_label);
            
            if isempty(match)
                check(kk,count) = 0;
            else
                overlaps = computeOverlap(boxes(kk,:), this_boxes(match,:));
                if max(overlaps)>0.5
                    check(kk,count) = 1;
                end
            end
        end
        count = count + 1;
    end
    
    tracks(ii).consistent = (sum(check,2)==size(check,2));
end
